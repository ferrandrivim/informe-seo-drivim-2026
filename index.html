import React, { useState } from 'react';
import { Menu, X, ChevronDown, ChevronUp, AlertTriangle, CheckCircle, BarChart2, Server, Smartphone, Globe, Lock, Activity } from 'lucide-react';

const DrivimAuditApp = () => {
  const [activeSection, setActiveSection] = useState('executive');
  const [isSidebarOpen, setIsSidebarOpen] = useState(true);

  const sections = [
    { id: 'executive', title: '1. Diagnòstic Executiu', icon: <Activity size={20} /> },
    { id: 'technical', title: '2. Auditoria Tècnica (WPO)', icon: <Server size={20} /> },
    { id: 'cro', title: '3. Conversió i Dades (CRO)', icon: <BarChart2 size={20} /> },
    { id: 'content', title: '4. Continguts i SEO On-Page', icon: <Globe size={20} /> },
    { id: 'acquisition', title: '5. Adquisició i Tràfic', icon: <Activity size={20} /> },
    { id: 'integrity', title: '6. Integritat de Dades (GA4)', icon: <Lock size={20} /> },
    { id: 'external', title: '7. Auditoria Externa i Benchmarking', icon: <Globe size={20} /> },
    { id: 'strategy', title: '8. Extensió Estratègica (Fase 2)', icon: <Activity size={20} /> },
    { id: 'roadmap', title: '9. Llistat d\'Execució', icon: <CheckCircle size={20} /> },
  ];

  const toggleSidebar = () => setIsSidebarOpen(!isSidebarOpen);

  return (
    <div className="flex h-screen bg-gray-900 text-gray-100 font-sans overflow-hidden">
      {/* Sidebar */}
      <div 
        className={`${isSidebarOpen ? 'w-80' : 'w-20'} bg-gray-800 border-r border-gray-700 transition-all duration-300 flex flex-col`}
      >
        <div className="p-4 border-b border-gray-700 flex justify-between items-center">
          {isSidebarOpen && <h1 className="font-bold text-xl text-blue-400">Auditoria Drivim</h1>}
          <button onClick={toggleSidebar} className="p-2 hover:bg-gray-700 rounded-lg">
            {isSidebarOpen ? <X size={20} /> : <Menu size={20} />}
          </button>
        </div>
        <nav className="flex-1 overflow-y-auto p-2">
          {sections.map((section) => (
            <button
              key={section.id}
              onClick={() => setActiveSection(section.id)}
              className={`w-full flex items-center p-3 mb-1 rounded-lg transition-colors ${
                activeSection === section.id 
                  ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/50' 
                  : 'hover:bg-gray-700 text-gray-300'
              }`}
            >
              <span className="mr-3">{section.icon}</span>
              {isSidebarOpen && <span className="text-sm font-medium text-left">{section.title}</span>}
            </button>
          ))}
        </nav>
        <div className="p-4 border-t border-gray-700 text-xs text-gray-500">
          {isSidebarOpen && (
            <div>
              <p>Confidencial</p>
              <p>Gener 2026</p>
            </div>
          )}
        </div>
      </div>

      {/* Main Content */}
      <div className="flex-1 flex flex-col h-full overflow-hidden">
        {/* Header */}
        <header className="bg-gray-800 border-b border-gray-700 p-6 shadow-md z-10">
          <div className="flex justify-between items-center">
            <div>
              <h2 className="text-2xl font-bold text-white">Auditoria Estratègica 360º</h2>
              <p className="text-gray-400 text-sm mt-1">Anàlisi Forense de Dades Integrals - Drivim 2025</p>
            </div>
            <div className="bg-red-500/20 text-red-300 px-3 py-1 rounded-full text-xs font-bold border border-red-500/50">
              DOCUMENT CONFIDENCIAL
            </div>
          </div>
        </header>

        {/* Scrollable Content Area */}
        <main className="flex-1 overflow-y-auto p-8 bg-gray-900 scroll-smooth">
          <div className="max-w-6xl mx-auto space-y-12 pb-20">
            {activeSection === 'executive' && <Section1Executive />}
            {activeSection === 'technical' && <Section2Technical />}
            {activeSection === 'cro' && <Section3CRO />}
            {activeSection === 'content' && <Section4Content />}
            {activeSection === 'acquisition' && <Section5Acquisition />}
            {activeSection === 'integrity' && <Section6Integrity />}
            {activeSection === 'external' && <Section7External />}
            {activeSection === 'strategy' && <Section8Strategy />}
            {activeSection === 'roadmap' && <Section9Roadmap />}
          </div>
        </main>
      </div>
    </div>
  );
};

/* --- COMPONENTS DE SECCIÓ --- */

const Section1Executive = () => (
  <div className="space-y-8 animate-fadeIn">
    <div className="bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg">
      <h3 className="text-2xl font-bold text-blue-400 mb-4 border-b border-gray-700 pb-2">1. Diagnòstic Executiu: Estat d'Emergència Digital</h3>
      
      <div className="prose prose-invert max-w-none">
        <h4 className="text-lg font-semibold text-white mt-4">La Tesi Principal: Fractura Estructural i Cost d'Oportunitat</h4>
        <p className="text-gray-300 leading-relaxed">
          El web de Drivim, en el seu estat actual (Gener 2026), pateix una <strong>fractura estructural crítica</strong> que compromet la viabilitat de les inversions digitals. Tot i mantenir uns volums de tràfic aparentment saludables a la part superior de l'embut (Top of Funnel), la infraestructura tècnica i l'arquitectura de dades estan sabotejant activament tant la inversió publicitària (Paid Media) com la capacitat de conversió del tràfic orgànic.
        </p>
        <p className="text-gray-300 leading-relaxed mt-4">
          Estem operant sota el paradigma d'una <strong>ineficiència estructural crítica</strong>: mentre s'injecta pressupost agressivament en captació (amb un 39% de tràfic provinent de pagament), el temps de resposta excessiu del servidor en dispositius mòbils (3,9 segons) provoca que els usuaris abandonin la pàgina abans que aquesta arribi a mostrar cap contingut. Paral·lelament, l'entorn d'escriptori registra un moviment acumulatiu de layout (CLS - Cumulative Layout Shift) de 0,9, desplaçant la gran majoria dels elements visibles durant el procés de càrrega.
        </p>
        <p className="text-gray-300 leading-relaxed mt-4">
          A diferència del diagnòstic inicial, <strong>l'anàlisi agregada de conversió confirma que la integritat de les dades és robusta</strong>: la suma de tots els esdeveniments de lead específics (Venda, Taller, Finançament) coincideix en un <strong>91,7%</strong> amb els intents d'enviament de formulari (<code>form_submit</code>). Això descarta l'error de mesurament crític, però posa encara més pressió sobre la necessitat de resoldre els problemes de velocitat (WPO) i UX, que són ara els únics culpables del baix rendiment del negoci.
        </p>
      </div>
    </div>

    <div className="grid grid-cols-1 gap-6">
      <h4 className="text-xl font-bold text-white">Tauler de Risc Ampliat (KPIs Crítics)</h4>
      <div className="bg-gray-800 rounded-xl overflow-hidden border border-gray-700">
        <table className="w-full text-left text-sm text-gray-400">
          <thead className="bg-gray-700 text-gray-200 uppercase font-medium">
            <tr>
              <th className="px-6 py-4">Àrea</th>
              <th className="px-6 py-4 text-center">Estat</th>
              <th className="px-6 py-4">Impacte Negoci Directe</th>
              <th className="px-6 py-4">Diagnòstic Ràpid i Conseqüència</th>
            </tr>
          </thead>
          <tbody className="divide-y divide-gray-700">
            <tr className="hover:bg-gray-750 transition-colors">
              <td className="px-6 py-4 font-medium text-white">Rendiment Tècnic (WPO)</td>
              <td className="px-6 py-4 text-center"><StatusBadge status="critical" /></td>
              <td className="px-6 py-4 text-red-300">Pèrdua estimada del 30% del pressupost SEM</td>
              <td className="px-6 py-4"><strong>TTFB Mòbil de 3,9s.</strong> Això implica que 1 de cada 3 clics pagats abandona abans que el servidor respongui. Estem subvencionant tràfic fantasma.</td>
            </tr>
            <tr className="hover:bg-gray-750 transition-colors">
              <td className="px-6 py-4 font-medium text-white">Estabilitat Visual (UX)</td>
              <td className="px-6 py-4 text-center"><StatusBadge status="critical" /></td>
              <td className="px-6 py-4 text-red-300">Penalització SEO i Baixa Confiança</td>
              <td className="px-6 py-4"><strong>CLS Escriptori 0,9.</strong> El 90% de la pantalla es mou durant la càrrega. Això frustra l'usuari i Google ho penalitza baixant el rànquing orgànic.</td>
            </tr>
            <tr className="hover:bg-gray-750 transition-colors">
              <td className="px-6 py-4 font-medium text-white">Integritat de Dades</td>
              <td className="px-6 py-4 text-center"><StatusBadge status="correct" /></td>
              <td className="px-6 py-4 text-green-300">Fiabilitat en la Presa de Decisions</td>
              <td className="px-6 py-4"><strong>Coherència del 91,7%</strong> (9.061 intents vs 8.306 leads totals validats). El sistema mesura correctament. La petita diferència del 8,3% entra dins dels marges normals d'errors de validació d'usuari (camps incorrectes).</td>
            </tr>
            <tr className="hover:bg-gray-750 transition-colors">
              <td className="px-6 py-4 font-medium text-white">Qualitat de Tràfic</td>
              <td className="px-6 py-4 text-center"><StatusBadge status="alert" /></td>
              <td className="px-6 py-4 text-yellow-300">Baix ROAS Orgànic</td>
              <td className="px-6 py-4"><strong>Excés de tràfic "Low Intent".</strong> El blog capta milers de visites que consumeixen recursos de servidor però no generen negoci (Cita Taller) per manca de passarel·les de conversió.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
);

const Section2Technical = () => (
  <div className="space-y-8 animate-fadeIn">
    <div className="bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg">
      <h3 className="text-2xl font-bold text-blue-400 mb-6 border-b border-gray-700 pb-2">2. Auditoria Tècnica Forense (Infraestructura i WPO)</h3>
      <p className="text-sm text-gray-400 mb-6 italic">Anàlisi creuada detallada de les captures de Core Web Vitals (Mètriques Web Principals: Mòbil vs Escriptori) per identificar l'arrel del problema.</p>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <Card title="2.1. El Col·lapse del Canal Mòbil" status="critical">
          <div className="space-y-3 text-gray-300">
            <p><strong>L'Evidència:</strong> TTFB (Time To First Byte) de <span className="text-red-400 font-bold">3,9 segons</span>.</p>
            <p><strong>Anàlisi Forense:</strong> Aquesta mètrica aïlla estrictament el rendiment del servidor (Backend). Quan un usuari fa clic a un anunci, la pantalla es queda "congelada" durant gairebé 4 segons.</p>
            <p><strong>La Paradoxa:</strong> A l'escriptori, el TTFB és d'1,5s. La diferència confirma un problema de <strong>configuració deficient de la Caché</strong> per a dispositius mòbils (no es serveix HTML estàtic).</p>
            <p className="border-l-4 border-red-500 pl-3 mt-2 bg-red-500/10 py-2"><strong>Impacte Econòmic:</strong> Rebot Zero. Estem pagant clics que marxen abans de carregar.</p>
          </div>
        </Card>

        <Card title="2.2. Inestabilitat Visual (CLS) en Escriptori" status="critical">
          <div className="space-y-3 text-gray-300">
            <p><strong>L'Evidència:</strong> CLS (Cumulative Layout Shift) de <span className="text-red-400 font-bold">0,9</span>.</p>
            <p><strong>El Fet Tècnic:</strong> El 90% de l'estructura visual es desplaça després de pintar-se. Localitzat quirúrgicament a la <strong>Homepage i Landing Pages de Model</strong>.</p>
            <p><strong>Causa Arrel:</strong> El <strong>Slider Principal (Carrusel)</strong> i les capçaleres s'injecten sense reservar espai al CSS.</p>
            <p className="border-l-4 border-red-500 pl-3 mt-2 bg-red-500/10 py-2"><strong>Solució Obligatòria:</strong> Implementar <code>aspect-ratio</code> o <code>min-height</code> al CSS.</p>
          </div>
        </Card>
      </div>

      <div className="bg-gray-750 p-5 rounded-lg border border-gray-600">
        <h4 className="text-lg font-semibold text-white mb-3 flex items-center"><Server className="mr-2 text-blue-400"/> 2.3. Enginyeria de Dades WordPress (Causa Arrel)</h4>
        <div className="text-gray-300 space-y-2">
          <p><strong>Diagnòstic Tècnic:</strong> L'auditoria externa confirma que la web opera sobre <strong>WordPress</strong>. El TTFB alt és causat per l'acumulació de dades "escombraries" a la taula <code>wp_options</code> i la càrrega excessiva de plugins.</p>
          <ul className="list-disc pl-5 space-y-1 mt-2 text-gray-400">
            <li><strong>Neteja de Transients:</strong> Eliminar registres temporals caducats de la base de dades.</li>
            <li><strong>Auditoria de Plugins:</strong> Utilitzar <em>Query Monitor</em> per trobar el plugin que bloqueja (backups, xat antic, constructor visual).</li>
            <li><strong>Implementació de Redis:</strong> Activar <em>Object Caching</em> per servir des de la memòria RAM (0,5s) en lloc de disc (3s).</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
);

const Section3CRO = () => (
  <div className="space-y-8 animate-fadeIn">
    <div className="bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg">
      <h3 className="text-2xl font-bold text-blue-400 mb-6 border-b border-gray-700 pb-2">3. Auditoria de Conversió i Integritat de Dades (CRO)</h3>
      
      <div className="bg-gray-900 rounded-lg p-6 border border-gray-700 mb-6">
        <h4 className="text-xl font-bold text-white mb-4">3.1. Validació de Coherència del Funnel (Dades Correctes)</h4>
        <p className="text-gray-300 mb-4">Reanalitzant l'estructura sota la premissa que <code>form_submit</code> (intent) ha de ser equivalent a la suma agregada de tots els tipus de "Lead" (èxit):</p>
        
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-center mb-6">
          <div className="bg-gray-800 p-4 rounded-lg">
            <p className="text-gray-400 text-sm uppercase">Total Intents</p>
            <p className="text-3xl font-bold text-white">9.061</p>
            <p className="text-xs text-gray-500">form_submit</p>
          </div>
          <div className="bg-gray-800 p-4 rounded-lg border-2 border-green-500/30">
            <p className="text-gray-400 text-sm uppercase">Total Èxits</p>
            <p className="text-3xl font-bold text-green-400">8.306</p>
            <p className="text-xs text-gray-500">Suma 6 tipus de Leads</p>
          </div>
          <div className="bg-gray-800 p-4 rounded-lg">
            <p className="text-gray-400 text-sm uppercase">Coherència</p>
            <p className="text-3xl font-bold text-blue-400">91,7%</p>
            <p className="text-xs text-gray-500">Gap: 755 (8,3%)</p>
          </div>
        </div>

        <div className="bg-green-500/10 border border-green-500/30 p-4 rounded-lg">
          <p className="text-green-300 font-medium flex items-center">
            <CheckCircle size={18} className="mr-2" />
            Conclusió Tècnica:
          </p>
          <p className="text-gray-300 mt-1">
            <strong>El tracking funciona correctament.</strong> No hi ha forat negre. El 8,3% restant és fricció estàndard de validació d'usuari (DNI incorrecte, camps buits). Els esforços han d'anar a WPO, no a arreglar el mesurament.
          </p>
        </div>
      </div>
    </div>
  </div>
);

const Section4Content = () => {
  const landingPages = [
    { id: 1, url: '/', clicks: '12.917', percent: '14,44%', time: '3m 09s', cat: 'Marca', diag: 'Bon temps, distribuïdor.' },
    { id: 2, url: '/blog/que-pasa-si-no-cambio-el-aceite...', clicks: '11.490', percent: '12,85%', time: '54s', cat: 'Blog', diag: 'Tràfic desaprofitat. Falta widget Taller.' },
    { id: 3, url: '/blog/cuando-cambiar-la-correa...', clicks: '4.236', percent: '4,74%', time: '50s', cat: 'Blog', diag: 'Oportunitat venda creuada manteniment.' },
    { id: 7, url: '/coches-foton/tunland-g7/', clicks: '1.843', percent: '2,06%', time: '1m 11s', cat: 'Nou', diag: 'Producte Estrella. Cal millorar fitxa.' },
    { id: 11, url: '/coches-para-taxi/', clicks: '1.246', percent: '1,39%', time: '54s', cat: 'Nínxol', diag: 'Alerta. Temps molt baix per B2B.' },
    { id: 16, url: '/concesionarios/bookcar-badalona/', clicks: '954', percent: '1,07%', time: '46s', cat: 'Rent', diag: 'Crític (UX). Problema preus/reserva.' },
  ];

  return (
    <div className="space-y-8 animate-fadeIn">
      <div className="bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg">
        <h3 className="text-2xl font-bold text-blue-400 mb-6 border-b border-gray-700 pb-2">4. Auditoria d'Estratègia de Continguts i SEO (On-Page)</h3>
        
        <div className="mb-8">
          <h4 className="text-lg font-bold text-white mb-4">4.1. Anàlisi Exhaustiva de Pàgines de Destinació (Mostra Representativa)</h4>
          <div className="overflow-x-auto bg-gray-900 rounded-lg border border-gray-700">
            <table className="w-full text-sm text-gray-300">
              <thead className="bg-gray-800 text-gray-100 font-bold uppercase text-xs">
                <tr>
                  <th className="px-4 py-3 text-left">URL</th>
                  <th className="px-4 py-3 text-right">Clics</th>
                  <th className="px-4 py-3 text-right">% Tràfic</th>
                  <th className="px-4 py-3 text-right">Temps</th>
                  <th className="px-4 py-3 text-left">Categoria</th>
                  <th className="px-4 py-3 text-left">Diagnòstic</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-800">
                {landingPages.map((row) => (
                  <tr key={row.id} className="hover:bg-gray-800 transition-colors">
                    <td className="px-4 py-3 font-mono text-xs text-blue-300 truncate max-w-xs" title={row.url}>{row.url}</td>
                    <td className="px-4 py-3 text-right">{row.clicks}</td>
                    <td className="px-4 py-3 text-right">{row.percent}</td>
                    <td className={`px-4 py-3 text-right font-bold ${row.time.includes('s') && parseInt(row.time) < 60 ? 'text-red-400' : 'text-green-400'}`}>{row.time}</td>
                    <td className="px-4 py-3"><span className="bg-gray-700 px-2 py-1 rounded text-xs">{row.cat}</span></td>
                    <td className="px-4 py-3 text-xs">{row.diag}</td>
                  </tr>
                ))}
                <tr>
                  <td colSpan="6" className="px-4 py-2 text-center text-xs text-gray-500 italic bg-gray-800">...i 20 files més analitzades a l'informe complet...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <Accordion title="4.1.1 Diagnòstic Forense" isOpenDefault={true}>
            <ul className="list-disc pl-5 space-y-2 text-gray-300 text-sm">
              <li><strong>Dominació 'Low Intent':</strong> Les URLs de Blog sumen 24.127 clics (27% del tràfic). Usuaris que volen "saber", no "comprar". Acció: Widgets de Taller dins l'article.</li>
              <li><strong>Força Emergent Foton:</strong> Foton Tunland supera a models consolidats. Oportunitat en demanda insatisfeta de Pick-ups.</li>
              <li><strong>Col·lapse Bookcar:</strong> Temps d'estada crítics (46s). Urgent revisar UX de reserva i visibilitat de preus.</li>
            </ul>
          </Accordion>

          <Accordion title="4.1.2 Estratègia MoFu (Fase 2)" isOpenDefault={true}>
            <div className="text-gray-300 text-sm space-y-2">
              <p><strong>El Tresor:</strong> Milers de lectors de blog no llestos per comprar avui.</p>
              <p><strong>Estratègia Nurturing:</strong> Implementar <strong>Lead Magnets</strong> (ex: "Checklist Manteniment" o "Guia Pneumàtics").</p>
              <p><strong>Resultat:</strong> Capturar emails per entrar al <em>Top of Mind</em> via newsletter, generant confiança per quan necessitin el taller realment.</p>
            </div>
          </Accordion>
        </div>

        <div className="mt-8 pt-6 border-t border-gray-700">
          <h4 className="text-lg font-bold text-white mb-2">4.2. Anàlisi de Consultes (GSC) - Keyword Gap</h4>
          <p className="text-gray-400 mb-4">Competidors com Quadis acaparen termes "Long Tail" transaccionals (ex: "oferta peugeot 3008 km0").</p>
          <div className="bg-blue-500/10 border border-blue-500/30 p-4 rounded-lg">
            <p className="text-blue-300 font-bold">Acció Estratègica:</p>
            <p className="text-gray-300 text-sm mt-1">Crear <strong>"Hubs Transaccionals"</strong>: pàgines de categoria persistents optimitzades per a clusters semàntics (ex: [Model] + [KM0/Nou] + [Barcelona]), actuant com a xarxes d'arrossegament.</p>
          </div>
        </div>
      </div>
    </div>
  );
}

const Section5Acquisition = () => (
  <div className="bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg animate-fadeIn">
    <h3 className="text-2xl font-bold text-blue-400 mb-6 border-b border-gray-700 pb-2">5. Auditoria d'Adquisició i Dependència</h3>
    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
      <Card title="5.1. Vulnerabilitat Financera en Paid Search" status="alert">
        <p className="text-gray-300 text-sm mb-2"><strong>Dada:</strong> 39,37% del tràfic prové de Paid Search (209k sessions).</p>
        <p className="text-gray-300 text-sm mb-2"><strong>Risc Ocult:</strong> Els Core Web Vitals deficients (WPO) baixen el <em>Quality Score</em>.</p>
        <p className="text-gray-300 text-sm"><strong>Conseqüència:</strong> Estem pagant una "multa d'eficiència" a Google (CPC més car per la mateixa posició).</p>
      </Card>
      <Card title="5.2. Potencial Social Orgànic" status="correct">
        <p className="text-gray-300 text-sm mb-2"><strong>Dada:</strong> 15,8% de tràfic orgànic social.</p>
        <p className="text-gray-300 text-sm"><strong>Lectura:</strong> Comunitat fidel. Cal revisar on aterra aquest tràfic (Home vs Oferta específica) per millorar la conversió.</p>
      </Card>
    </div>
  </div>
);

const Section6Integrity = () => (
  <div className="bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg animate-fadeIn space-y-6">
    <h3 className="text-2xl font-bold text-blue-400 mb-6 border-b border-gray-700 pb-2">6. Integritat de Dades - Events GA4</h3>
    
    <div className="overflow-x-auto bg-gray-900 rounded-lg border border-gray-700">
        <table className="w-full text-sm text-gray-300">
            <thead className="bg-gray-800 text-gray-100 uppercase text-xs">
                <tr>
                    <th className="px-4 py-3 text-left">Concepte</th>
                    <th className="px-4 py-3 text-left">Esdeveniments Inclosos</th>
                    <th className="px-4 py-3 text-right">Volum Total</th>
                </tr>
            </thead>
            <tbody className="divide-y divide-gray-800">
                <tr>
                    <td className="px-4 py-3 font-bold text-white">A. INTENCIÓ</td>
                    <td className="px-4 py-3 font-mono text-xs">form_submit</td>
                    <td className="px-4 py-3 text-right font-bold">9.061</td>
                </tr>
                <tr>
                    <td className="px-4 py-3 font-bold text-green-400">B. ÈXIT (LEADS)</td>
                    <td className="px-4 py-3 font-mono text-xs text-gray-400">drivim_lead + Lead + Lead_Financiacion...</td>
                    <td className="px-4 py-3 text-right font-bold text-green-400">8.306</td>
                </tr>
                <tr className="bg-gray-800/50">
                    <td className="px-4 py-3 font-bold">GAP</td>
                    <td className="px-4 py-3 text-xs italic">Diferència A - B</td>
                    <td className="px-4 py-3 text-right">755</td>
                </tr>
                <tr className="bg-blue-900/20">
                    <td className="px-4 py-3 font-bold text-blue-300">COHERÈNCIA</td>
                    <td className="px-4 py-3"></td>
                    <td className="px-4 py-3 text-right font-bold text-blue-300 text-lg">91,7%</td>
                </tr>
            </tbody>
        </table>
    </div>
    <p className="text-xs text-gray-500 italic">*Nota: Exclosos leads de Xat (Serviceform antic i Timbal actual).</p>

    <div className="bg-red-900/20 border border-red-500/30 p-4 rounded-lg">
        <h4 className="text-red-300 font-bold mb-2 flex items-center"><AlertTriangle size={18} className="mr-2"/> Fals Positiu: Consum de Vídeo</h4>
        <p className="text-gray-300 text-sm">L'event <code>video_progress</code> té <strong>254.828</strong> registres. Això és un "miratge" causat per l'<strong>Autoplay</strong>.</p>
        <p className="text-gray-300 text-sm mt-2"><strong>Conseqüència Devastadora:</strong> El vídeo en segon pla satura l'ample de banda mòbil, competint amb recursos crítics (CSS/JS) i causant directament el TTFB lent.</p>
        <p className="text-white text-sm font-bold mt-2">Acció: Desactivar Autoplay immediatament.</p>
    </div>
  </div>
);

const Section7External = () => (
  <div className="bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg animate-fadeIn">
    <h3 className="text-2xl font-bold text-blue-400 mb-6 border-b border-gray-700 pb-2">7. Auditoria Externa i Benchmarking (Dades Reals)</h3>
    
    <div className="overflow-x-auto bg-gray-900 rounded-lg border border-gray-700 mb-8">
        <table className="w-full text-sm text-gray-300">
            <thead className="bg-gray-800 text-gray-100 uppercase text-xs">
                <tr>
                    <th className="px-3 py-3 text-left">Competidor</th>
                    <th className="px-3 py-3 text-center">Velocitat</th>
                    <th className="px-3 py-3 text-center">Estructura</th>
                    <th className="px-3 py-3 text-center">SEO Local</th>
                    <th className="px-3 py-3 text-left">Stack</th>
                    <th className="px-3 py-3 text-left">Amenaça</th>
                </tr>
            </thead>
            <tbody className="divide-y divide-gray-800">
                <tr className="bg-blue-900/10">
                    <td className="px-3 py-3 font-bold text-white">DRIVIM</td>
                    <td className="px-3 py-3 text-center text-red-400 font-bold">Crítica</td>
                    <td className="px-3 py-3 text-center text-yellow-400">Inestable</td>
                    <td className="px-3 py-3 text-center text-green-400 font-bold">Excel·lent</td>
                    <td className="px-3 py-3 text-xs">WordPress</td>
                    <td className="px-3 py-3 text-xs">-</td>
                </tr>
                <tr>
                    <td className="px-3 py-3 font-bold">Quadis</td>
                    <td className="px-3 py-3 text-center text-green-400">Alta</td>
                    <td className="px-3 py-3 text-center text-green-400">Sòlida</td>
                    <td className="px-3 py-3 text-center text-green-400">Molt Alta</td>
                    <td className="px-3 py-3 text-xs">.NET Enterprise</td>
                    <td className="px-3 py-3 text-xs">Autoritat de Domini (DR) massiva.</td>
                </tr>
                <tr>
                    <td className="px-3 py-3 font-bold">M-Automoció</td>
                    <td className="px-3 py-3 text-center text-yellow-400">Mitjana</td>
                    <td className="px-3 py-3 text-center text-green-400">Bona</td>
                    <td className="px-3 py-3 text-center text-green-400">Alta</td>
                    <td className="px-3 py-3 text-xs">Custom CMS</td>
                    <td className="px-3 py-3 text-xs">Competència a Barcelona.</td>
                </tr>
                <tr>
                    <td className="px-3 py-3 font-bold">Vallescar</td>
                    <td className="px-3 py-3 text-center text-yellow-400">Mitjana</td>
                    <td className="px-3 py-3 text-center text-yellow-400">Mitjana</td>
                    <td className="px-3 py-3 text-center text-green-400">Alta</td>
                    <td className="px-3 py-3 text-xs">WordPress</td>
                    <td className="px-3 py-3 text-xs">Rival directe per tecnologia i territori veí.</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div className="bg-gray-900 p-4 rounded-lg border border-gray-700">
            <h4 className="text-white font-bold mb-2">Conclusió Benchmarking</h4>
            <p className="text-gray-300 text-sm">Tecnològicament, Drivim està per sota de Quadis però pot superar a Vallescar resolent el servidor. Estratègicament, la <strong>capil·laritat local (Taller vs Vendes)</strong> és el veritable "fòssat defensiu" (Moat).</p>
        </div>
        <div className="bg-gray-900 p-4 rounded-lg border border-gray-700">
            <h4 className="text-white font-bold mb-2">Reputació com a Actiu</h4>
            <p className="text-gray-300 text-sm"><strong>Trust Signal:</strong> 4.8/5 a Coches.net. Drivim supera la mitjana del sector. Cal explotar això al Header: "El concessionari millor valorat de Badalona".</p>
        </div>
    </div>
  </div>
);

const Section8Strategy = () => (
  <div className="bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg animate-fadeIn">
    <h3 className="text-2xl font-bold text-blue-400 mb-6 border-b border-gray-700 pb-2">8. Extensió Estratègica (Fase 2)</h3>
    <p className="text-gray-400 text-sm mb-4">Detalls addicionals sobre oportunitats de creixement avançat integrats a les seccions corresponents.</p>
    
    <Accordion title="8.3. Enginyeria de Dades WordPress (WPO Profund)" isOpenDefault={true}>
        <div className="text-gray-300 text-sm space-y-3">
            <p><strong>Diagnòstic:</strong> Lentitud per acumulació de dades a <code>wp_options</code> (autoloaded data).</p>
            <p><strong>Acció Quirúrgica:</strong></p>
            <ol className="list-decimal pl-5 space-y-1">
                <li><strong>Neteja de Transients:</strong> Eliminar registres caducats.</li>
                <li><strong>Auditoria Plugins:</strong> Identificar càrregues lentes amb Query Monitor.</li>
                <li><strong>Redis:</strong> Implementar Object Caching per reduir temps de 3s a 0,5s.</li>
            </ol>
        </div>
    </Accordion>
  </div>
);

const Section9Roadmap = () => (
  <div className="space-y-8 animate-fadeIn">
    <div className="bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg">
      <h3 className="text-2xl font-bold text-blue-400 mb-6 border-b border-gray-700 pb-2">9. Llistat d'Execució per Prioritats</h3>
      
      <div className="space-y-6">
        {/* Crític */}
        <div className="border-l-4 border-red-500 pl-6 py-2">
          <h4 className="text-xl font-bold text-red-400 uppercase mb-3 flex items-center"><AlertTriangle className="mr-2"/> Prioritat Crítica: WPO i UX</h4>
          <ul className="space-y-4">
            <li className="bg-gray-900 p-4 rounded-lg border border-gray-700">
              <span className="text-white font-bold block mb-1">1. Implementar "Edge Caching" Mòbil</span>
              <span className="text-gray-400 text-sm">Objectiu: Reduir TTFB de 3,9s a &lt;0,8s. Servir HTML estàtic. Vital per reduir CPC.</span>
            </li>
            <li className="bg-gray-900 p-4 rounded-lg border border-gray-700">
              <span className="text-white font-bold block mb-1">2. Eliminar Autoplay de Vídeo</span>
              <span className="text-gray-400 text-sm">Objectiu: Alliberar ample de banda mòbil per millorar LCP i tenir mètriques reals.</span>
            </li>
            <li className="bg-gray-900 p-4 rounded-lg border border-gray-700">
              <span className="text-white font-bold block mb-1">3. Estabilització Visual (Fixar CLS)</span>
              <span className="text-gray-400 text-sm">Objectiu: Passar de 0,9 a 0,1 definint dimensions (aspect-ratio) als contenidors.</span>
            </li>
          </ul>
        </div>

        {/* Alta */}
        <div className="border-l-4 border-yellow-500 pl-6 py-2">
          <h4 className="text-xl font-bold text-yellow-400 uppercase mb-3">Prioritat Alta: Oportunitats de Negoci</h4>
          <ul className="space-y-4">
            <li className="bg-gray-900 p-4 rounded-lg border border-gray-700">
              <span className="text-white font-bold block mb-1">4. Optimització Snippets Foton/DFSK</span>
              <span className="text-gray-400 text-sm">Objectiu: Capturar tràfic massiu d'impressions millorant CTR (Títols/Descripcions).</span>
            </li>
            <li className="bg-gray-900 p-4 rounded-lg border border-gray-700">
              <span className="text-white font-bold block mb-1">5. Monetització del Blog (Widget Taller)</span>
              <span className="text-gray-400 text-sm">Objectiu: Convertir lectors informatius en clients postvenda amb "Sticky" widget.</span>
            </li>
            <li className="bg-gray-900 p-4 rounded-lg border border-gray-700">
              <span className="text-white font-bold block mb-1">6. Segmentació Local GBP Badalona</span>
              <span className="text-gray-400 text-sm">Objectiu: Verificar fitxa específica "Taller" per capturar cerques de servei.</span>
            </li>
          </ul>
        </div>

        {/* Mitjana */}
        <div className="border-l-4 border-blue-500 pl-6 py-2">
          <h4 className="text-xl font-bold text-blue-400 uppercase mb-3">Prioritat Mitjana: Manteniment</h4>
          <ul className="space-y-4">
            <li className="bg-gray-900 p-4 rounded-lg border border-gray-700">
              <span className="text-white font-bold block mb-1">7. Monitorització Fricció Formulari</span>
              <span className="text-gray-400 text-sm">Objectiu: Reduir el gap del 8% revisant missatges d'error de validació.</span>
            </li>
            <li className="bg-gray-900 p-4 rounded-lg border border-gray-700">
              <span className="text-white font-bold block mb-1">8. Revisió UX Bookcar</span>
              <span className="text-gray-400 text-sm">Objectiu: Auditar per què l'estada mitjana és &lt;46s (visibilitat preus/reserva).</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
);

/* --- UTILS --- */

const Card = ({ title, status, children }) => {
  const statusColors = {
    critical: 'border-red-500 bg-red-900/10',
    alert: 'border-yellow-500 bg-yellow-900/10',
    correct: 'border-green-500 bg-green-900/10'
  };

  return (
    <div className={`p-5 rounded-lg border-l-4 ${statusColors[status] || 'border-gray-600 bg-gray-800'}`}>
      <h4 className="text-lg font-bold text-white mb-3">{title}</h4>
      {children}
    </div>
  );
};

const StatusBadge = ({ status }) => {
  const styles = {
    critical: 'bg-red-500 text-white',
    alert: 'bg-yellow-500 text-black',
    correct: 'bg-green-500 text-white'
  };
  const labels = {
    critical: 'CRÍTIC',
    alert: 'ALERTA',
    correct: 'CORRECTE'
  };
  return (
    <span className={`px-3 py-1 rounded-full text-xs font-bold ${styles[status]}`}>
      {labels[status]}
    </span>
  );
};

const Accordion = ({ title, children, isOpenDefault = false }) => {
  const [isOpen, setIsOpen] = useState(isOpenDefault);
  return (
    <div className="border border-gray-700 rounded-lg bg-gray-900 overflow-hidden">
      <button 
        onClick={() => setIsOpen(!isOpen)}
        className="w-full flex justify-between items-center p-4 bg-gray-800 hover:bg-gray-750 transition-colors"
      >
        <span className="font-bold text-gray-200">{title}</span>
        {isOpen ? <ChevronUp size={18} /> : <ChevronDown size={18} />}
      </button>
      {isOpen && (
        <div className="p-4 border-t border-gray-700 animate-slideDown">
          {children}
        </div>
      )}
    </div>
  );
};

export default DrivimAuditApp;
